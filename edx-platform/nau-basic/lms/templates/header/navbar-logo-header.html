## mako

<%page expression_filter="h" args="online_help_token"/>


<%namespace name='static' file='../static_content.html'/>
<%!
from django.urls import reverse
from django.utils.translation import ugettext as _
from lms.djangoapps.ccx.overrides import get_current_ccx
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from openedx.core.djangoapps.lang_pref.api import header_language_selector_is_enabled, released_languages

%>

<%
  www_pt = static.get_value('NAU_MARKETING_BASE_HREF', {}).get("pt-pt", "")
  www_en = static.get_value('NAU_MARKETING_BASE_HREF', {}).get("en", "") 
  nau_lang_menu = static.get_value('NAU_NAVBAR_LANGUAGE_SELECTOR')   
 
  if LANGUAGE_CODE == "pt-pt":
    header_menu = static.get_value('NAU_HEADER_MENU', {}).get("pt-pt", {})
  else:
    header_menu = static.get_value('NAU_HEADER_MENU', {}).get("en", {})
  endif 

 
%> 

<%doc>

    <h1 class="header-logo">
        <%block name="navigation_logo">
        <a href="/" class="logo"></a>
        </%block>  
      % if course:
        <div class="course-header">
          <span class="provider">${course.display_org_with_default}:</span>
          <span class="course-number">${course.display_number_with_default}</span>
          <%
          display_name = course.display_name_with_default
          if settings.FEATURES.get('CUSTOM_COURSES_EDX', False):
            ccx = get_current_ccx(course.id)
            if ccx:
              display_name = ccx.display_name
          %>
          <span class="course-name">${display_name}</span>
        </div>
      % endif
    </h1>

    % if enable_enterprise_sidebar:
      <div class="enterprise-tagline">
        <% tagline = configuration_helpers.get_value('ENTERPRISE_TAGLINE', settings.ENTERPRISE_TAGLINE) %>
        % if tagline:
          ${tagline}
        % endif
      </div>
    % endif

</%doc>


% if not nau_lang_menu:

    <!-- Prepares Script and hidden form to post language settings -->

    <script>
    function nau_set_lang(event, language) {
        url = $('.url-endpoint').val(),
        is_user_authenticated = JSON.parse($('.url-endpoint').data('user-is-authenticated'));
        event.preventDefault();
        
        Language.submitAjaxRequest(language, url, function() {
            if (is_user_authenticated) {
                // User language preference has been set successfully
                // Now submit the form in success callback.
                $('#nau-nav-language-settings-form').submit();
            } else {
                Language.refresh();
            }
        });
    }
    </script>

    <% languages = released_languages() %>
    
    % if len(languages) > 1:
        <form action="/i18n/setlang/" method="post" class="settings-language-form" id="nau-nav-language-settings-form">
            <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
            % if user.is_authenticated:
            <input title="preference api" type="hidden" class="url-endpoint" value="${reverse('preferences_api', kwargs={'username': user.username})}" data-user-is-authenticated="true">
            % else:
            <input title="session update url" type="hidden" class="url-endpoint" value="${reverse('session_language')}" data-user-is-authenticated="false">
            % endif            
            <input type="hidden" id="nau-nav-settings-language-value" name="language">
        </form>
    % endif
    
% endif


<div id="branding-top-nav">

    <a id="open-menu-arrow" href="javascript:void(0)" onclick="openNav(0)" title="Abrir">&#9776;</a>
    <a href="${www_pt}" class="logo"></a>

    <!-- starts menu container -->
    <div class="menu-container">

      <!-- starts top nav menu -->
      <a id="close-menu-arrow" href="javascript:void(0)" onclick="closeNav(0)" title="Fechar">&#10005;</a>
      <div class="nav-icon"></div>

      <ul id="about-categories-entities" class="main-menu">
        % if isinstance(header_menu, dict):
          ## old code
          % for title in header_menu:
            <% link = header_menu[title]["link"] %>
            <li class="menu-item menu-item-type-post_type menu-item-object-page 
            % if len(header_menu[title]["itens"]): 
              menu-item-has-children 
            % endif 
            ">
              <a href="${link}">${title}</a>
              %if len(header_menu[title]["itens"]):
              <ul class="sub-nav menu-depth-0">
              % for label in header_menu[title]["itens"]:
                <% link = header_menu[title]["itens"][label] %>
                <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="${link}">${label}</a></li>
              %endfor
              </ul>      
              %endif
            </li>
          % endfor
        % else:
          % for parent_header in header_menu:
            <% item_link = parent_header["link"] %>
            <% html_link = parent_header["html"] %>
            <% children = parent_header.get("itens", {}) %>
            <% has_children = len(children) > 0 %>
            <li class="menu-item menu-item-type-post_type menu-item-object-page ${'menu-item-has-children' if has_children else ''}">
              <a href="${item_link}">${html_link}</a>
              % if has_children:
                <ul class="sub-nav menu-depth-0">
                % for sub_item in children:
                  <% sub_item_link = sub_item["link"] %>
                  <% sub_item_html = sub_item["html"] %>
                  <li class="menu-item menu-item-type-post_type menu-item-object-page"><a href="${sub_item_link}">${sub_item_html}</a></li>
                %endfor
                </ul>
              % endif
            </li>
          % endfor
        % endif
      </ul>



      <!-- starts top nav action container -->
      <div id="actions_container"> 
  
          <!-- starts top nav search bar -->          
          <form id="search-form" action="${www_pt}" role="search" method="get">
            <input id="search-input" name="s" type="search" placeholder="${_("Search courses...")}" value="">
            <input name="submit-search" type="submit">
          </form>
          <!-- ends top nav search bar -->

      
      <!-- starts menu languages --> 
      
      <%doc>
      % if nau_lang_menu:
         <div id="languages-actions-container">
           <ul id="menu_languages">
           % if LANGUAGE_CODE == "pt-pt":
             <li class="current_language">PT</li>
             <li><a onclick="nau_set_lang(event, 'en')">EN</a></li>
           % else:
             <li><a onclick="nau_set_lang(event, 'pt-pt')">PT</a></li>
             <li class="current_language">EN</li>
           % endif
           </ul>
         </div>
      % endif
      </%doc>
      
      % if user.is_authenticated:
            <%include file="navbar-authenticated.html" args="online_help_token=online_help_token"/>
      % else:
            <%include file="navbar-not-authenticated.html" args="online_help_token=online_help_token"/>
      % endif
            
        <div class="hamburger-menu" role="button" aria-label=${_("Options Menu")} aria-expanded="false" aria-controls="mobile-menu" tabindex="0">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </div>        
        
        <!-- ends login and register -->     
        </div>        
    <!-- ends top nav action container --> 
    </div>    
<!-- ends menu container -->     
</div>







<!-- ends branding container -->
<div class="menu-overlay" onclick="closeNav(0)"></div>

  % if course:
    <div class="course-header">
      <span class="provider">${course.display_org_with_default}:</span>
      <span class="course-number">${course.display_number_with_default}</span>
      <%
      display_name = course.display_name_with_default
      if settings.FEATURES.get('CUSTOM_COURSES_EDX', False):
        ccx = get_current_ccx(course.id)
        if ccx:
          display_name = ccx.display_name
      %>
      <span class="course-name">${display_name}</span>
    </div>
  % endif


<script>
// starts menu opening and closing button for menu: cross
const menuContainer = document.querySelector(".menu-container");
const bodyOverlay = document.getElementsByTagName("body")[0];
const openMenu = document.getElementById("open-menu-arrow");

function openNav() {
  menuContainer.style.cssText = "display: block";
  openMenu.style.cssText = "display:none;"; 
  document.getElementById("close-menu-arrow").style.cssText = "display:block";
  document.querySelector(".menu-overlay").style.cssText = "display:block;"; 
  bodyOverlay.classList.add("enable-overlay");
}
function closeNav() {
  menuContainer.style.cssText = "display: none";
  openMenu.style.cssText = "display:block;";
  document.getElementById("close-menu-arrow").style.cssText = "display:none";  
  document.querySelector(".menu-overlay").style.cssText = "display:none;";
  bodyOverlay.classList.remove("enable-overlay");
}
// ends menu opening and closing button for menu: cross
</script>